<%
# sources:
# https://stackoverflow.com/questions/5113248/devise-update-user-without-password
# https://github.com/heartcombo/devise/wiki/How-To:-Allow-users-to-edit-their-account-without-providing-a-password
%>

<div class="col-md-8 col-md-offset-2">
    <div class="row">
        <div class="panel panel-default">
            <div class="panel-heading">
                <h2>Edit Your Account</h2>
            </div>

            <div class="panel-body">
                <%= simple_form_for(
                    @listing,
                    as: user,
                    url: :user,
                    html: {
                        authenticity_token: true,
                        method: :put,
                        multipart: true,
                        class: 'form-horizontal ',
                        presence: true
                }) do |f| %>
                    <%= devise_error_messages! %>

                    <% if devise_mapping.confirmable? && resource.pending_reconfirmation? %>
                        <div>Currently waiting confirmation for: <%= resource.unconfirmed_email %></div>
                    <% end %>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">Username</span>
                        <%= f.label :username %><br>
                    </div>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">Email</span>
                        <%= f.email_field :email, class: "form-control" %>
                    </div>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">Profile image</span>
                        <%= f.file_field :avatar, class: "form-control" %>
                    </div>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">Biography</span>
                        <%= f.text_area :bio, class: "form-control" %>
                    </div>
                    <br>

                    <div class = "small-heading", style="color:red">We will need your current password whento allow a password change.</div>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">Current Password</span>
                        <%= f.password_field :current_password, autocomplete: "off", class: "form-control" %>
                    </div>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">New Password</span>
                        <%= f.password_field :password, autocomplete: "off", class: "form-control" %>
                    </div>
                    <br>

                    <div class="input-group">
                        <span class="input-group-addon">New Password Confirmation</span>
                        <%= f.password_field :password_confirmation, autocomplete: "off", class: "form-control" %>
                    </div>
                    <br>

                    <div class="form-group">
                        <%= f.submit "Update", class: "btn btn-success", id: "profile_submit" %>
                    </div>
                <% end %>
        </div>
    </div>
</div>
<br>

<%= render "processing_overlay" %>

<script>
$(function () {
    $('#profile_submit').on('click', function(){
        if (document.getElementById('edit_user').checkValidity() == true){
            $("#overlay").toggle()
        }
    })
});
</script>
